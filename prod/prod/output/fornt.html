
<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Log Viewer — Upload + Table</title>
<style>
  :root{--bg:#f8fafc;--muted:#94a3b8;--panel:#fff;--accent:#0f172a;--th:#e2e8f0;--filter:#f1f5f9;}
  body{font-family:Inter, Arial, sans-serif;background:var(--bg);color:var(--accent);margin:18px;}
  h1{text-align:center;margin-bottom:8px;font-size:20px;}
  .center-row{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:10px;}
  .choose-btn{background:#0b63d6;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer;}
  .file-label{font-weight:600;color:var(--muted);margin-left:6px;}
  .search-row{display:flex;justify-content:center;margin-bottom:12px;}
  .search-row input[type="search"]{width:70%;padding:10px 12px;border-radius:8px;border:1px solid #cbd5e1;font-size:14px;}
  .controls-wrap{max-width:1200px;margin:0 auto;}
  .table-wrap{overflow:auto;background:var(--panel);padding:10px;border-radius:8px;box-shadow:0 2px 6px rgba(2,6,23,0.06);}
  table{width:100%;border-collapse:collapse;min-width:1000px;}
  th,td{border:1px solid #e6eef8;padding:8px 6px;text-align:center;font-size:13px;vertical-align:middle;}
  thead th{background:var(--th);font-weight:600;}
  .filters td{background:var(--filter);padding:10px;}
  .checkbox-list{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;align-items:center;}
  .small{font-size:12px;color:var(--muted);}
  .pagination{margin-top:12px;display:flex;justify-content:center;gap:10px;align-items:center;}
  .pagination button{padding:6px 10px;border-radius:6px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;}
  .pagination button[disabled]{opacity:0.5;cursor:not-allowed;}
  .page-num{padding:6px 8px;border-radius:6px;background:#0b63d6;color:#fff;font-weight:600;}
  .empty-cell{color:#9aa7b8;}
  .row-even{background:#fbfdff;}
  .time-inputs{display:flex;gap:6px;justify-content:center;align-items:center;}
  .time-inputs input{padding:6px 8px;border-radius:6px;border:1px solid #cbd5e1;font-size:13px;}
  .btn-sm{padding:6px 8px;border-radius:6px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;}
  .info-count{color:var(--muted);font-size:13px;text-align:center;margin-top:6px;}
  .log-console{margin-top:10px;font-size:13px;color:#334155;background:#f8fafc;border:1px dashed #cbd5e1;padding:8px;border-radius:6px;min-height:22px;}
  .status { font-weight:600; margin-left:10px; color:#0b63d6;}
  @media (max-width:900px){ .search-row input[type="search"]{width:92%;} table{min-width:800px;} }
</style>
</head>
<body>
  <h1>Log Viewer</h1>

  <!-- Center file chooser + label -->
  <div class="center-row">
    <button id="chooseBtn" class="choose-btn">Выберите файл</button>
    <span class="file-label">JSON</span>
    <span id="uploadStatus" class="status"></span>
  </div>

  <!-- Search -->
  <div class="search-row">
    <input id="globalSearch" type="search" placeholder="Поиск по всем полям (id, apply/plan, caller, level, info, time)..." />
  </div>


  <div class="controls-wrap">
    <div class="table-wrap">
      <table id="logTable" aria-describedby="infoCount">
        <thead>
          <tr>
            <th>#</th>
            <th>apply\plan</th>
            <th>caller</th>
            <th>level</th>
            <th>info</th>
            <th>Время</th>
          </tr>
          <tr class="filters" id="filterRow">
            <td></td>
            <td>
              <div class="checkbox-list">
                <!-- NOTE: default unchecked to show ALL logs when none checked -->
                <label><input type="checkbox" class="filter-type" value="apply" /> apply</label>
                <label><input type="checkbox" class="filter-type" value="plan" /> plan</label>
              </div>
            </td>
            <td>
              <select id="filterCaller" style="padding:6px;border-radius:6px;border:1px solid #cbd5e1;">
                <option value="all">Всё</option>
                <option value="yes">Да</option>
                <option value="no">Нет</option>
              </select>
            </td>
            <td>
              <div class="checkbox-list" style="justify-content:center;">
                <!-- default unchecked -> show all levels -->
                <label><input type="checkbox" class="filter-level" value="trace" /> trace</label>
                <label><input type="checkbox" class="filter-level" value="info" /> info</label>
                <label><input type="checkbox" class="filter-level" value="debug" /> debug</label>
                <label><input type="checkbox" class="filter-level" value="warn" /> warn</label>
                <label><input type="checkbox" class="filter-level" value="error" /> error</label>
                <label><input type="checkbox" class="filter-level" value="off" /> off</label>
              </div>
            </td>
            <td></td>
            <td>
              <div class="time-inputs" style="flex-direction:column;">
                <div style="display:flex; gap:6px; justify-content:center;">
                  <input id="timeFrom" type="datetime-local" step="0.001" title="Начало"/>
                  <input id="timeTo"   type="datetime-local" step="0.001" title="Конец"/>
                </div>
                <div style="display:flex; gap:6px; justify-content:center; margin-top:6px;">
                  <button id="lastSix" class="btn-sm">Последние 6 мес</button>
                  <button id="clearTime" class="btn-sm">Очистить</button>
                </div>
              </div>
            </td>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>

    <div class="info-count" id="infoCount">Показано 0 записей</div>

    <div class="pagination" id="pagination">
      <button id="prevBtn" class="btn-sm">Пред</button>
      <span id="pageInfo" class="page-num">1</span>
      <button id="nextBtn" class="btn-sm">Дальше</button>
    </div>

    <div class="log-console" id="logConsole">Готов.</div>
  </div>

<input type="file" id="fileInput" accept="application/json" style="display:none"/>

<script>
/*
  Frontend behavior:
  - User clicks "Выберите файл" -> file selected -> upload to POST /upload (multipart/form-data)
  - UI shows upload status. After upload, front-end polls GET /api/logs until it sees updated parsed logs or times out.
  - Filters start UNCHECKED: meaning if no checkboxes are checked we treat it as "allow all".
  - Table has 100 placeholder empty rows when no logs.
  - Pagination and search are client-side.
*/
